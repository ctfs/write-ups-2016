# PentestCyprus 2.0 | Crypto Teaser

**Category:** Crypto
**Points:** N/A
**Solves:** N/A
**Description:**

> Where could it be?

## Write-up

The challenge description doesn't say much so we inspect the page source for any hints.  
We can easily spot the following element: `<img data-message="Let's see what you've got!" data-type="Cryptography" data-id="CRYPTO010T" style="position:absolute;top:-333px;left:-333px;" src="data:image/gif;base64,VSB2cGwgc...">`  
We then open the image src in a new tab but it dosn't look like a real image so we get the base64 part and do a simple base64 decode  
The decoded part is the following:

>U vpl rukst ex p ilxnrhdhyulm mh cuw p ikhykpf mrpm celssfst mh rpqs "lmkpgys homiom" vkummsg ex hgs hc rul sw-ykpt lmotsgml. Um vpl p ikhykpf mrpm ksptl p tpmp cuds, plbl pehom 50 joslmuhgl, thsl lhfs npdnodpmuhgl, pgt nhfsl oi vumr lhfs lnhks eplst hg mrul IrT'l kslspknr. Um'l hg p kslspknr 3E2 pm mrs oguqsklumx. Rs tsfhglmkpmsl mrs ikhykpf pgt loks sghoyr mrsks lssfst mh es lmkpgys cdplrugy vhktl hg mrs lnkssg vrsg um fhqsl ckhf joslmuhg mh joslmuhg, pgt mrsx thg'm lssf guns. U pykss mh th um, lrhodt es iksmmx lmkpuyrmchkvpkt, lh rs'dd ipx fs ex mrs rhok mh tsmskfugs rhv euy mrs cuw ul pgt mrsg vs'dd pykss mh p css.
>
>Tpx 1
>U lum thvg pm mrs 3E2 pgt dhyug mh mrs sw-ykpt lmotsgm'l pnnhogm mrpm rpl essg yuqsg mh fs. Mrul ul vrsks mrs nhts kslutsl. U swpfugs mrs N nhts. Um ul vkummsg mh es8t rpkt mh kspt. Pdd mrs nhts ul ljoulrst hg hgs dugs. Um'l likspt hqsk 15 cudsl vumr pehom 3 cognmuhgl isk cuds -- pdd hg hgs dugs. Pdd qpkupeds gpfsl pks aolm mrkss, lssfugydx kpgthf, dsmmskl. U mpdb mh mrs yox pgt pykss mh yh vumr rhokdx hg mrul (ykspm tsnuluhg). U ogmpgyds pdd mrs nhts pgt chkfpm um gunsdx lh U npg lss um.
>
>Um vpl thgs hg iokihls. Um olst mrs noklsl duekpkx mh fhqs mh p ihugm hg mrs lnkssg, ikugm p joslmuhg pgt mrs pglvskl, pgt vpum chk p kslihgls. Eom um cuklm vsgm mh mrs cuklm dugs hc mrs joslmuhg, ikugmst lhfs vrums loiksfpnx fsllpys, vpumst 1/2 p lsnhgt, pgt mrsg hqskvkhms um vumr mrs joslmuhg. Mrul hoyrm mh es lufids. Mrsks pks hgdx pehom cuqs idpnsl um nhodt homiom pgxmrugy, pgt pdd hc mrsf rpt mrul loedufugpd cdplr hc p fsllpys. Spnr hgs vpl rpkt nhtst. Gh ikhedsf. Tsdsms mrs hccsgtugy fqikugmv() pgt pdd ul vsdd. Hk lrhodt es. U nhfiuds, mrugbugy U'f thgs. Eom vrsg U kpg um, mrsks um ul pypug -- mrs loedufugpd fsllpysl. Mrul mufs vumr tuccsksgm mswm lmudd mrs lpfs loeasnm, aolm tuccsksgm fsllpysl.
>
>U nrsnb fx nhts pgt esdusqs um hk ghm um'l epnb mh mrs ugumupd lmpms U chogt um. 15 cudsl, fpgydst, 3-dsmmsk qpkupedsl -- mrs vrhds mrugy kuyrm epnb vrsks U lmpkmst. U vpgm lrhhm fxlsdc chk ghm fpbugy p nhix hc fx nhts. U ogfpgyds pypug, mrul mufs iommugy um ug mrkss cudsl, gpfst tuccsksgmdx. U fpbs p nhix hc mrs vrhds tuksnmhkx, pgt U fpkb mrs cudsl ksptpeds hgdx. U nhfiudst um. Pdd dhhbl yhht. U kog mrs ikhykpf. Mrsks'l ghv p nhix hc mrs hkuyugpd 15 cudsl ug mrs tuksnmhkx pdhgy vumr fugs pgt mrs loedufugpd fsllpysl pks epnb.
>
>Hbpx, lh lhfsvrsks hg mrs tulb ul mrs lhokns nhts gsnsllpkx mh bssi thugy mrul pgt rs'l lsm mrs ikhykpf oi mh iodd ug mrpm nhts vrsg xho nhfiuds um. U th p codd tulb lspknr ug mrs ugndots pkspl (/olk/ugndots) pgt lugns mrul ul p kslspknr qskluhg vs rpqs lhokns chk aolm pehom sqskxmrugy eom mrs bskgsd umlsdc. Mrpm'l p dhm hc rsptsk cudsl pgt mrul mpbsl lhfs mufs hg mrs 3E2, lh mrpm'l tpx 1.
>
>Tpx 298
>Mrs tulb lspknr lrhvst oi ghmrugy. Mrs lmkugyl vsks piipksgmdx sumrsk sgnkximst hk mrsx pks eokust ug p duekpkxes lhfsvrsks. Esnpols U thg'm rpqs nrsnb lofl hc pdd mrs hkuyugpd swsnompeds heasnml, U tsnuts mh lspknr pdd duekpkusl chk mrs mswm. Mrul ul sqsg dhgysk mrpg eschks, lh tpx mvh ul hqsk.
>
>Tpx 3
>Gh kslodml. Mrs lmkugyl pks sgnkximst. Mrpm fspgl U'f yhugy mh rpqs mh chddhv pdd mrs rsptsk cudsl ckhf spnr #ugndots pgt spnr hgs mrsx #ugndots mh cugt vrsks mrul ul. Pgt mrpm vudd, mpbs lhfs mufs. Vs th pdskm mrs npfiol nhfiomugy tsipkmfsgm mrpm vs esdusqs lhfshgs rpl ypugst khhm dsqsd pnnsll mh Tk. Irsdil kslspknr nhfiomsk, vrunr ul aolm p lrpkst dpe nhfiomsk ug mrs lnusgns eoudtugy. Mrsx'ks ogtsklmpgtpedx ghm nhgqugnst.
>
>U lmpkm ogvugtugy mrs #ugndots cudsl. U th mrpm, ghvrsks th U cugt mrs nhts. Lh ghv U12 bghv um'l nhfiudst ug p duekpkx. Gh ikhedsf pm pdd. Vrx ghm aolm ksnhfiuds pdd mrhls duekpkusl, vs th rpqs mrs lhokns pcmsk pdd.
>
>Tpxl 4-6
>Mrs rpktslm ipkm, nhgqugnugy mrs npfiol gsktl65 mrsx rpqs pg ullos. Eom vs cugpddx th pgt Fpkb, mrs Oguw ptfugtt vrh vpl rukst esnpols rs fpkkust mrs Tspg'l tpoyrmsk, ysml eolx dspkgugy rhv mh th mrul. Ug mrs sgt, rs pykssl mh pddhv fs mh rpgtds um, esnpols rs aolm thslg'm kspddx bghv rhv mh ysm pdd mrpm lmocc nhfiudst. Sgt hc Tpx 6, pdd lmpgtpkt duekpkusl pks ksnhfiudst. Vhh rhh!
>
>U vrui hom fx fhtucust88, ndspgst oi lhokns pgt lmpkm mrs nhfiuds. Pdd dhhbl yhht. U kog um. H F Y. Um tut um pypug. 15 fsllst oi lhokns cudsl pgt mrs loedufugpd fsllpyslep pks epnb. Mrul ul lottsgdx dubs fpyun. U ugqslmuypms qskx qskx npkscoddx mrhoyr U pf lmofist. Mrul nhts thslg'm swulm ug lhokns nhts. U mrugb U fuyrm es espmsg. Tk. Irsdil ulg'm rpiix vumr mrs rhokl ugqhdqst pgt mrugbl fpxes vs hoyrm mh aolm ksvkums mrs ikhykpf ckhf lnkpmnr. "Loks", U lpx lmpkugy pm mrs mskfugpd dubs p dhlm ioiix mhh tssi ug fx mrhoyrml mh iom hom hc fx mrugbugy fhts, "U mrugb xho'ks kuyrm. Mrpm vudd es jounbsk." "Yhht," rs lpxl, "vs npg lmpkm mhfhkkhv."
>
>Tpx 7
>Mh rsdd vumr mrpm. Mrul yox ulg'm espmugy fs. Vs pks nhfiudugy um ckhf rul lmugbugy nhts hk ghm pm pdd! "Xho thg'm rpqs mh ipx fs pgxfhks, Tk. Irsdil, U aolm vpgm dpe mufs." Mrul ul gskt vpk.
>
>Tpxl 8-14
>U ysm lfpkm, U'f mrugbugy rs lhfsrhvn5 fhtucust mrs noklsl duekpkx. U nhfiuds mrs noklsl nhts mh pllsfedx pgt mrhoyr U thg'm bghv 3E222 pllsfedx (xsm!), U lmpkm dspkgugy.  U kspt fpgopdl chk 6 tpxl, iusnugy mhysmrsk mrpm pllsfedx nhts. Vplms hc mufs, ghmrugy lssfl ogolopd.
>
>Tpx 15
>U lottsgdx kspduzs um'l ug mrs nhfiudsks1. Um vpl mrs nhfiudsk. Pgt sqskx mufs xho nhfiuds mrs hkuyugpd nhts pgt kog um ioml ug mrs loedufugpd fsllpyse2 nhts ugmh mrs lhokns nhts. U't rspkt hc mrul eschks.
>
>Pr pr! U'qs yhm ruf!!!! Vs rpqs mrs lhokns nhts chk mrs nhfiudsk pl vsdd. U lspknr mrkhoyr um dhhbugy chk p kscsksgns. Dh pgt esrhdt, U cugt um. Ugtsst. Mrsks ul lhokns nhts ug mrs eumdx2e3J9C6 nhfiudsk/dugbsk mrpm thsl mrul:
>1) um swpfugsl pgx npdd mh chisg(), lspknrsl mrs cuds hisgst dhhbugy chk Tk. Irsdi'l joslmuhgl; uc um cugtl mrsf mrsg
>2) um ksvkumsl mrs 15 cudsl mh mrs nokksgm tuksnmhkx vrsg nhfiudugy mrpm lisnucun ikhykpf.
>3) Um mrsg nhfiudsl Tk. Irsdil ikhykpf olugy mrs 1518 cudsl pgt homioml mh mrs -h gpfs ug mrs dugb irpls.
>
>Mrs nhfiudsk vpl fhtucust mh iom mrpm nhts ug Tk. Irsdil ikhykpf vpl vkummsg ex mrs fpg mrpm fhtucust mrs nhfiudsk.
>
>Lsqskpd tpxl dpmsk, pg PM&M msnr lrhvl oi vumr p tulb pgt dhptl21 mrs ikhisk nhfiuds pgt dugbsk lhokns pgt vs ksnhfiuds mrs nhfiudsk ckhf mrs lhokns. Mrpm lhdqsl um. Pdd mrs ept lhokns ug mrs nhfiudsk ul yhgs pgt vs'qs yhm p gsv ndspg nhix hc mrs nhfiudsk.
>
>Swnsim um tutg'm. Esnpols mrs nhfiudsk vpl ihulhgst vumr hmrsk lhokns nhts mrpm vs tutg'm rpqs. Pgt mrpm lhokns nhts, mrpm ghv swulmst hgdx ug mrs swsnompeds nhfiudsk, iom mrhls nrpgysl epnb ugmh mrs nhfiudsk lhokns eschks um nhfiudst um. Eom mrul mufs um tutg'm fhtucx mrs /olk/lkn nhix, um nhiust um mh p ruttsg tuksnmhkx, fhtucust mrs nhfiudsk lhokns, nhfiudst umlsdc ckhf mrsks, pgt tsdsmst mrs ruttsg tuksnmhkx. Um mhhb pg PM&M msnr mh cugt mrul. Mrs sw-ykpt lmotsgm rpt ihulhgst mrs nhfiudsk mh ihulhg umlsdc vrsg um vpl ksnhfiudst. Vs rpt mh iom p gsv eugpkx qskluhg hc mrs nhfiudsk hg tulb ckhf pghmrsk 3E2 koggugy mrs lpfs ksquluhg eschks mrs ikhedsf vsgm pvpx.
>
>Vs pdlh chogt mrpm uc /leug/dhyug ul nhfiudst um ioml ug p epnbthhk pddhvugy pgxhgs vrh olsl p lisnucun ipllvhkt mh dhyug ug pl mrs khhm olsk. Mrul nhfiomsk ul pnnsllueds ex fhtsf40 pgt Mxfgsm. Cugpddx, mrul ysml mrs nhfiomugy nsgmsk'l pmmsgmuhg.
>
>Ysguol! Eom iom mh p rhkkueds npols.

It looks like the text is encrypted and as we look more closely only the letters are encrypted. So first thing that comes to our mind is it's a **Substitution Cypher**

Trying with a simple Caesar cypher solver doesn't work so it has to be a **Keyed Caesar**. Now we can start the guessing game to find the key, or use a more advanced cryptogram solver that calculates the key based on the english letter frequency.  After a few simple guesses we find that the key is **pentestcyprus** so the alphabet goes like this **pentscyruabdfghijklmoqvwxz**  

>I was hired by a psychologist to fix a program that fbseemed to have "strange output" written by one of his ex-grad students. It was a program that reads a data file, asks about 50 questions, does some calculations, and comes up with some score based on this PhD's research. It's on a research 3B2 at the university. He demonstrates the program and sure enough there seemed to be strange flashing words on the screen when it moves from question to question, and they don't seem nice. I agree to do it, should be pretty straightforward, so he'll pay me by the hour to determine how big the fix is and then we'll agree to a fee.
>
>Day 1
>I sit down at the 3B2 and login to the ex-grad student's account that has been given to me. This is where the code resides. I examine the C code. It is written to be8d hard to read. All the code is squished on one line. It's spread over 15 files with about 3 functions per file -- all on one line. All variable names are just three, seemingly random, letters. I talk to the guy and agree to go with hourly on this (great decision). I untangle all the code and format it nicely so I can see it.
>
>It was done on purpose. It used the curses library to move to a point on the screen, print a question and the answers, and wait for a response. But it first went to the first line of the question, printed some white supremacy message, waited 1/2 a second, and then overwrote it with the question. This ought to be simple. There are only about five places it could output anything, and all of them had this subliminal flash of a message. Each one was hard coded. No problem. Delete the offending mvprintw() and all is well. Or should be. I compile, thinking I'm done. But when I ran it, there it is again -- the subliminal messages. This time with different text still the same subject, just different messages.
>
>I check my code and believe it or not it's back to the initial state I found it. 15 files, mangled, 3-letter variables -- the whole thing right back where I started. I want shoot myself for not making a copy of my code. I unmangle again, this time putting it in three files, named differently. I make a copy of the whole directory, and I mark the files readable only. I compiled it. All looks good. I run the program. There's now a copy of the original 15 files in the directory along with mine and the subliminal messages are back.
>
>Okay, so somewhere on the disk is the source code necessary to keep doing this and he's set the program up to pull in that code when you compile it. I do a full disk search in the include areas (/usr/include) and since this is a research version we have source for just about everything but the kernel itself. That's a lot of header files and this takes some time on the 3B2, so that's day 1.
>
>Day 298
>The disk search showed up nothing. The strings were apparently either encrypted or they are buried in a librarybe somewhere. Because I don't have check sums of all the original executable objects, I decide to search all libraries for the text. This is even longer than before, so day two is over.
>
>Day 3
>No results. The strings are encrypted. That means I'm going to have to follow all the header files from each #include and each one they #include to find where this is. And that will, take some time. We do alert the campus computing department that we believe someone has gained root level access to Dr. Phelps research computer, which is just a shared lab computer in the science building. They're understandably not convinced.
>
>I start unwinding the #include files. I do that, nowhere do I find the code. So now I12 know it's compiled in a library. No problem at all. Why not just recompile all those libraries, we do have the source after all.
>
>Days 4-6
>The hardest part, convincing the campus nerds65 they have an issue. But we finally do and Mark, the Unix admindd who was hired because he married the Dean's daughter, gets busy learning how to do this. In the end, he agrees to allow me to handle it, because he just doesn't really know how to get all that stuff compiled. End of Day 6, all standard libraries are recompiled. Woo hoo!
>
>I whip out my modified88, cleaned up source and start the compile. All looks good. I run it. O M G. It did it again. 15 messed up source files and the subliminal messagesba are back. This is suddenly like magic. I investigate very very carefully though I am stumped. This code doesn't exist in source code. I think I might be beaten. Dr. Phelps isn't happy with the hours involved and thinks maybe we ought to just rewrite the program from scratch. "Sure", I say staring at the terminal like a lost puppy too deep in my thoughts to put out of my thinking mode, "I think you're right. That will be quicker." "Good," he says, "we can start tomorrow."
>
>Day 7
>To hell with that. This guy isn't beating me. We are compiling it from his stinking code or not at all! "You don't have to pay me anymore, Dr. Phelps, I just want lab time." This is nerd war.
>
>Days 8-14
>I get smart, I'm thinking he somehowc5 modified the curses library. I compile the curses code to assembly and though I don't know 3B222 assembly (yet!), I start learning.  I read manuals for 6 days, piecing together that assembly code. Waste of time, nothing seems unusual.
>
>Day 15
>I suddenly realize it's in the compilere1. It was the compiler. And every time you compile the original code and run it puts in the subliminal messageb2 code into the source code. I'd heard of this before.
>
>Ah ah! I've got him!!!! We have the source code for the compiler as well. I search through it looking for a reference. Lo and behold, I find it. Indeed. There is source code in the bitly2b3Q9F6 compiler/linker that does this:
>1) it examines any call to fopen(), searches the file opened looking for Dr. Phelp's questions; if it finds them then
>2) it rewrites the 15 files to the current directory when compiling that specific program.
>3) It then compiles Dr. Phelps program using the 1518 files and outputs to the -o name in the link phase.
>
>The compiler was modified to put that code in Dr. Phelps program was written by the man that modified the compiler.
>
>Several days later, an AT&T tech shows up with a disk and loads21 the proper compile and linker source and we recompile the compiler from the source. That solves it. All the bad source in the compiler is gone and we've got a new clean copy of the compiler.
>
>Except it didn't. Because the compiler was poisoned with other source code that we didn't have. And that source code, that now existed only in the executable compiler, put those changes back into the compiler source before it compiled it. But this time it didn't modify the /usr/src copy, it copied it to a hidden directory, modified the compiler source, compiled itself from there, and deleted the hidden directory. It took an AT&T tech to find this. The ex-grad student had poisoned the compiler to poison itself when it was recompiled. We had to put a new binary version of the compiler on disk from another 3B2 running the same revision before the problem went away.
>
>We also found that if /sbin/login is compiled it puts in a backdoor allowing anyone who uses a specific password to login in as the root user. This computer is accessible by modem40 and Tymnet. Finally, this gets the computing center's attention.
>
>Genius! But put to a horrible cause.

The final step is to find the **hash**. Here we have multiple ways of finding it:  
- One is by reading the story and finding the *mistakes* in some words like: **fbseemed**, **Day 298**, **somehowc5** etc
- By doing a **diff** with the original article
- By reading the article until the end where there is a **bit.ly** link

## Other write-ups and resources

* none yet
